# To use this in a package, use
# include: 'https://gitlab.com/debian-pm/tools/build/raw/master/docker/gitlab-ci-base.yml'

cache:
  paths:
    - debian/ccache/amd64
    - debian/ccache/arm64
    - debian/ccache/arm64-caf
    - debian/ccache/i386
    - debian/ccache/armhf
    - debian/ccache/armhf-caf

before_script:
  - apt update

variables:
  REPO_BRANCH: "main"

build:source:
  stage: build
  script: /usr/bin/ci-build source
  image: $CI_REGISTRY_IMAGE:latest-amd64

build:amd64:
  stage: build
  script: /usr/bin/ci-build binary
  image: $CI_REGISTRY_IMAGE:latest-amd64
  tags:
    - amd64

build:i386:
  stage: build
  script: /usr/bin/ci-build binary
  image: $CI_REGISTRY_IMAGE:latest-i386
  tags:
    - i386

build:armhf:
  stage: build
  script: /usr/bin/ci-build binary
  image: $CI_REGISTRY_IMAGE:latest-armhf
  tags:
    - armhf

build:arm64:
  stage: build
  script: /usr/bin/ci-build binary
  image: $CI_REGISTRY_IMAGE:latest-arm64
  tags:
    - arm64
